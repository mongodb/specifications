version: 1
style: unit
description: must not let more than waitQueueSize threads enter the queue
poolOptions:
  maxPoolSize: 1
  waitQueueSize: 1
operations:
  # Check out sole possible connection
  - name: checkOut
  # Start a thread, have it enter sole wait queue spot
  - name: start
    target: thread1
  - name: checkOut
    thread: thread1
  - name: wait
    ms: 20
  # Start another thread, have it attempt to enter wait queue, find it full, error
  - name: start
    target: thread2
  - name: checkOut
    thread: thread2
  - name: waitFor
    target: thread2
error:
  type: WaitQueueFullError
  message: Attempted to check out a connection from connection pool while waitQueue was full
events:
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckedOut
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckOutFailed
    reason: queueFull
ignore:
  - ConnectionCreated
  - ConnectionReady
  - ConnectionClosed
  - ConnectionPoolCreated