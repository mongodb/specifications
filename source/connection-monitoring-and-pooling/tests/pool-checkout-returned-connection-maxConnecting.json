{
  "version": 1,
  "style": "integration",
  "description": "threads blocked by maxConnecting check out returned connections",
  "runOn": [
    {
      "minServerVersion": "4.4.0"
    }
  ],
  "failPoint": {
    "configureFailPoint": "failCommand",
    "mode": {
      "times": 3
    },
    "data": {
      "failCommands": [
        "isMaster"
      ],
      "closeConnection": false,
      "blockConnection": true,
      "blockTimeMS": 750
    }
  },
  "poolOptions": {
    "maxPoolSize": 10,
    "waitQueueTimeoutMS": 5000
  },
  "operations": [
    {
      "name": "start",
      "target": "thread1"
    },
    {
      "name": "checkOut",
      "thread": "thread1",
      "label": "conn0"
    },
    {
      "name": "start",
      "target": "thread2"
    },
    {
      "name": "waitForEvent",
      "thread": "thread2",
      "event": "ConnectionCheckedOut",
      "count": 1
    },
    {
      "name": "checkOut",
      "thread": "thread2"
    },
    {
      "name": "start",
      "target": "thread3"
    },
    {
      "name": "waitForEvent",
      "thread": "thread3",
      "event": "ConnectionCheckedOut",
      "count": 1
    },
    {
      "name": "checkOut",
      "thread": "thread3"
    },
    {
      "name": "start",
      "target": "thread4"
    },
    {
      "name": "waitForEvent",
      "thread": "thread4",
      "event": "ConnectionCreated",
      "count": 3
    },
    {
      "name": "checkOut",
      "thread": "thread4"
    },
    {
      "name": "waitForEvent",
      "thread": "thread1",
      "event": "ConnectionCreated",
      "count": 3
    },
    {
      "name": "wait",
      "thread": "thread1",
      "ms": 100
    },
    {
      "name": "checkIn",
      "thread": "thread1",
      "connection": "conn0"
    },
    {
      "name": "waitForEvent",
      "event": "ConnectionCheckedOut",
      "count": 4
    }
  ],
  "events": [
    {
      "type": "ConnectionCreated",
      "address": 42,
      "connectionId": 1
    },
    {
      "type": "ConnectionCheckedOut",
      "address": 42
    },
    {
      "type": "ConnectionCreated",
      "address": 42
    },
    {
      "type": "ConnectionCreated",
      "address": 42
    },
    {
      "type": "ConnectionCheckedIn",
      "connectionId": 1,
      "address": 42
    },
    {
      "type": "ConnectionCheckedOut",
      "connectionId": 1,
      "address": 42
    },
    {
      "type": "ConnectionCheckedOut",
      "address": 42
    },
    {
      "type": "ConnectionCheckedOut",
      "address": 42
    }
  ],
  "ignore": [
    "ConnectionClosed",
    "ConnectionReady",
    "ConnectionPoolCreated",
    "ConnectionCheckOutStarted"
  ]
}
