version: 1
style: unit
description: must issue Connections to threads in the order that the threads eneterd the queue
poolOptions:
  maxPoolSize: 1
operations:
    # Acquire sole connection in pool
  - name: checkOut
    label: conn0
    # Create 4 threads, have them all queue up for connections
  - name: start
    target: thread1
  - name: checkOut
    thread: thread1
    label: conn1
  - name: start
    target: thread2
  - name: checkOut
    thread: thread2
    label: conn2
  - name: start
    target: thread3
  - name: checkOut
    thread: thread3
    label: conn3
  - name: start
    target: thread4
  - name: checkOut
    thread: thread4
    label: conn4
    # From main thread, keep checking in connection and then wait for appropriate thread
    # Test will timeout if threads are not enqueued in proper order
  - name: checkIn
    connection: conn0
  - name: waitFor
    target: thread1
  - name: checkIn
    connection: conn1
  - name: waitFor
    target: thread2
  - name: checkIn
    connection: conn2
  - name: waitFor
    target: thread3
  - name: checkIn
    connection: conn3
  - name: waitFor
    target: thread4
events:
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckedOut
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckOutStarted
  - type: ConnectionCheckedIn
  - type: ConnectionCheckedOut
  - type: ConnectionCheckedIn
  - type: ConnectionCheckedOut
  - type: ConnectionCheckedIn
  - type: ConnectionCheckedOut
  - type: ConnectionCheckedIn
  - type: ConnectionCheckedOut
ignore:
  - ConnectionCreated
  - ConnectionReady
  - ConnectionClosed
  - ConnectionPoolCreated