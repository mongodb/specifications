description: driver-sessions-argument-for-correct-client

schemaVersion: "1.0"

createEntities:
  - client:
      id: &client0 client0
  - client:
      id: &client1 client1
  - database:
      id: &database0 database0
      client: *client0
      databaseName: &database0Name session-tests
  - collection:
      id: &collection0 collection0
      database: *database0
      collectionName: &collection0Name test
  - session:
      id: &session1 session1
      client: *client1

tests:
  - description: Session argument is for the right client (insertOne)
    operations:
      - name: insertOne
        object: *collection0
        arguments:
          session: *session1
          document: { _id: 2 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (insertMany)
    operations:
      - name: insertMany
        object: *collection0
        arguments:
          session: *session1
          documents: [ { _id: 1 } ]
        expectError:
          isClientError: true
  - description: Session argument is for the right client (deleteOne)
    operations:
      - name: deleteOne
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (deleteMany)
    operations:
      - name: deleteMany
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (updateOne)
    operations:
      - name: updateOne
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
          update: { $set: { x: 2 } }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (updateMany)
    operations:
      - name: updateMany
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
          update: { $set: { x: 2 } }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (updateSearchIndex)
    operations:
      - name: updateSearchIndex
        object: *collection0
        arguments:
          session: *session1
          name: test index
          definition: {}
        expectError:
          isClientError: true
  - description: Session argument is for the right client (replaceOne)
    operations:
      - name: replaceOne
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
          replacement: { x: 2 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (aggregate)
    operations:
      - name: aggregate
        object: *collection0
        arguments:
          session: *session1
          pipeline: []
        expectError:
          isClientError: true
  - description: Session argument is for the right client (bulkWrite)
    operations:
      - name: bulkWrite
        object: *collection0
        arguments:
          session: *session1
          requests: []
        expectError:
          isClientError: true
  - description: Session argument is for the right client (estimatedDocumentCount)
    operations:
      - name: estimatedDocumentCount
        object: *collection0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (distinct)
    operations:
      - name: distinct
        object: *collection0
        arguments:
          session: *session1
          fieldName: x
          filter: {}
        expectError:
          isClientError: true
  - description: Session argument is for the right client (find)
    operations:
      - name: find
        object: *collection0
        arguments:
          session: *session1
          filter: { _id: 1 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (findOne)
    operations:
      - name: findOne
        object: *collection0
        arguments:
          session: *session1
          filter: { _id: 1 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (findOneAndDelete)
    operations:
      - name: findOneAndDelete
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (findOneAndReplace)
    operations:
      - name: findOneAndReplace
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
          replacement: { x: 2 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (findOneAndUpdate)
    operations:
      - name: findOneAndUpdate
        object: *collection0
        arguments:
          session: *session1
          filter: { x: 3 }
          update: { $set: { x: 2 } }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (countDocuments)
    operations:
      - name: countDocuments
        object: *collection0
        arguments:
          session: *session1
          filter: {}
        expectError:
          isClientError: true
  - description: Session argument is for the right client (createFindCursor)
    operations:
      - name: createFindCursor
        object: *collection0
        arguments:
          session: *session1
          filter: {}
        expectError:
          isClientError: true
  - description: Session argument is for the right client (createIndex)
    operations:
      - name: createIndex
        object: *collection0
        arguments:
          session: *session1
          name: foo
          keys: { x: 1 }
        expectError:
          isClientError: true
  - description: Session argument is for the right client (createSearchIndex)
    operations:
      - name: createSearchIndex
        object: *collection0
        arguments:
          session: *session1
          model: {}
        expectError:
          isClientError: true
  - description: Session argument is for the right client (createSearchIndexes)
    operations:
      - name: createSearchIndexes
        object: *collection0
        arguments:
          session: *session1
          models: []
        expectError:
          isClientError: true
  - description: Session argument is for the right client (dropIndex)
    operations:
      - name: dropIndex
        object: *collection0
        arguments:
          session: *session1
          name: x_1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (dropIndexes)
    operations:
      - name: dropIndexes
        object: *collection0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (dropSearchIndex)
    operations:
      - name: dropSearchIndex
        object: *collection0
        arguments:
          session: *session1
          name: x_1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (listIndexes)
    operations:
      - name: listIndexes
        object: *collection0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (listSearchIndexes)
    operations:
      - name: listSearchIndexes
        object: *collection0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (listCollections)
    operations:
      - name: listCollections
        object: *database0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (listCollectionNames)
    operations:
      - name: listCollectionNames
        object: *database0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (dropCollection)
    operations:
      - name: dropCollection
        object: *database0
        arguments:
          collection: collection0
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (listDatabases)
    operations:
      - name: listDatabases
        object: *client0
        arguments:
          session: *session1
        expectError:
          isClientError: true
  - description: Session argument is for the right client (clientBulkWrite)
    runOnRequirements:
      - minServerVersion: "8.0"
    operations:
      - name: clientBulkWrite
        object: *client0
        arguments:
          models: []
          session: *session1
        expectError:
          isClientError: true
