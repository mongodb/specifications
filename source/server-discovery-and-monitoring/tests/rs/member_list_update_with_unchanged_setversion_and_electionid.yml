# This test validates that the member list (hosts) is updated even when
# setVersion and electionId remain unchanged.
description: Member list is updated when setVersion and electionId remain the same
uri: "mongodb://a/?replicaSet=rs"
phases:
  # Phase 1: Initial state - A is primary with two members (a, b)
  - responses:
      -
        - "a:27017"
        - ok: 1
          helloOk: true
          isWritablePrimary: true
          hosts:
            - "a:27017"
            - "b:27017"
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
          minWireVersion: 0
          maxWireVersion: 17
      -
        - "b:27017"
        - ok: 1
          helloOk: true
          isWritablePrimary: false
          secondary: true
          hosts:
            - "a:27017"
            - "b:27017"
          setName: rs
          setVersion: 1
          minWireVersion: 0
          maxWireVersion: 17
    outcome:
      servers:
        a:27017:
          type: RSPrimary
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
        b:27017:
          type: RSSecondary
          setName: rs
          setVersion: 1
          electionId: null
      topologyType: ReplicaSetWithPrimary
      logicalSessionTimeoutMinutes: null
      setName: rs
      maxSetVersion: 1
      maxElectionId: {"$oid": "000000000000000000000001"}
  # Phase 2: Primary reports a new member c has been added, but setVersion and
  # electionId remain unchanged. The driver should add c to the topology.
  - responses:
      -
        - "a:27017"
        - ok: 1
          helloOk: true
          isWritablePrimary: true
          hosts:
            - "a:27017"
            - "b:27017"
            - "c:27017"
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
          minWireVersion: 0
          maxWireVersion: 17
    outcome:
      servers:
        a:27017:
          type: RSPrimary
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
        b:27017:
          type: RSSecondary
          setName: rs
          setVersion: 1
          electionId: null
        c:27017:
          type: Unknown
          setName: null
          setVersion: null
          electionId: null
      topologyType: ReplicaSetWithPrimary
      logicalSessionTimeoutMinutes: null
      setName: rs
      maxSetVersion: 1
      maxElectionId: {"$oid": "000000000000000000000001"}
  # Phase 3: c responds and becomes a secondary
  - responses:
      -
        - "c:27017"
        - ok: 1
          helloOk: true
          isWritablePrimary: false
          secondary: true
          hosts:
            - "a:27017"
            - "b:27017"
            - "c:27017"
          setName: rs
          setVersion: 1
          minWireVersion: 0
          maxWireVersion: 17
    outcome:
      servers:
        a:27017:
          type: RSPrimary
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
        b:27017:
          type: RSSecondary
          setName: rs
          setVersion: 1
          electionId: null
        c:27017:
          type: RSSecondary
          setName: rs
          setVersion: 1
          electionId: null
      topologyType: ReplicaSetWithPrimary
      logicalSessionTimeoutMinutes: null
      setName: rs
      maxSetVersion: 1
      maxElectionId: {"$oid": "000000000000000000000001"}
  # Phase 4: Primary reports c has been removed, but setVersion and
  # electionId remain unchanged. The driver should remove c from the topology.
  - responses:
      -
        - "a:27017"
        - ok: 1
          helloOk: true
          isWritablePrimary: true
          hosts:
            - "a:27017"
            - "b:27017"
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
          minWireVersion: 0
          maxWireVersion: 17
    outcome:
      servers:
        a:27017:
          type: RSPrimary
          setName: rs
          setVersion: 1
          electionId: {"$oid": "000000000000000000000001"}
        b:27017:
          type: RSSecondary
          setName: rs
          setVersion: 1
          electionId: null
      topologyType: ReplicaSetWithPrimary
      logicalSessionTimeoutMinutes: null
      setName: rs
      maxSetVersion: 1
      maxElectionId: {"$oid": "000000000000000000000001"}

