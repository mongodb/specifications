description: "expectedEventsForClient-topologyDescriptionChangedEvent"

schemaVersion: "1.20"

runOnRequirements:
  - topologies:
      - replicaset
    minServerVersion: "4.4" # awaitable hello

tests:
  - description: "can assert on values of newDescription and previousDescription fields"
    operations:
      - name: createEntities
        object: testRunner
        arguments:
          entities:
            - client:
                id: &client client
                observeEvents:
                  - topologyDescriptionChangedEvent
      # ensure the topology has been fully discovered before closing the client.
      # expected events are initial server discovery and 3 server connect events.
      - name: waitForEvent
        object: testRunner
        arguments:
          client: *client
          event:
            topologyDescriptionChangedEvent: {}
          count: 1
    expectEvents:
      - client: *client
        eventType: sdam
        ignoreExtraEvents: true 
        events:
          - topologyOpeningEvent: {}
          - topologyDescriptionChangedEvent: 
            previousDescription:
              type: "Unknown"
            newDescription:
              type: "ReplicaSetWithPrimary"

