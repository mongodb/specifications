runOn:
  - minServerVersion: "4.1.10"
database_name: &database_name "default"
collection_name: &collection_name "default"

data: []
key_vault_data: [{{key()}}]

tests:
  - description: "Schema with an encrypted field in an array"
    clientOptions:
      auto_encrypt_opts:
        schema_map:
          "default.default": {{schema('invalid_array')}}
        kms_providers:
          aws: {} # Credentials filled in from environment.
    operations:
      - name: insertOne
        arguments:
          document: &doc0 { _id: 1, ssn: "457-55-5462" }
        result:
          errorContains: "Invalid schema"
    outcome:
      collection:
        data: []
  - description: "Schema without specifying parent object types"
    clientOptions:
      auto_encrypt_opts:
        schema_map:
          "default.default": {{schema('invalid_omitted_type')}}
        kms_providers:
          aws: {} # Credentials filled in from environment.
    operations:
      - name: insertOne
        arguments:
          document: *doc0
        result:
          errorContains: "Invalid schema"
    outcome:
      collection:
        data: []
  - description: "Schema with siblings of encrypt document"
    clientOptions:
      auto_encrypt_opts:
        schema_map:
          "default.default": {{schema('invalid_siblings')}}
        kms_providers:
          aws: {} # Credentials filled in from environment.
    operations:
      - name: insertOne
        arguments:
          document: *doc0
        result:
          errorContains: "'encrypt' cannot be used in conjunction with 'bsonType'"
    outcome:
      collection:
        data: []
  - description: "Schema with logical keywords"
    clientOptions:
      auto_encrypt_opts:
        schema_map:
          "default.default": {{schema('logical_keywords')}}
        kms_providers:
          aws: {} # Credentials filled in from environment.
    operations:
      - name: insertOne
        arguments:
          document: *doc0
        result:
          errorContains: "Invalid schema"
    outcome:
      collection:
        data: []