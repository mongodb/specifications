description: createKey-dataKeyOpts-keyMaterial-invalid_length

schemaVersion: "1.8"

runOnRequirements:
  - csfle: true

createEntities:
  - client:
      id: &client0 client0
  - clientEncryption:
      id: &clientEncryption0 clientEncryption0
      clientEncryptionOpts:
        keyVaultClient: *client0
        keyVaultNamespace: keyvault.datakeys
        kmsProviders:
          local:
            key: { $$placeholder: 1 }

tests:
  - description: create datakey with custom key material
    operations:
      - name: createKey
        object: *clientEncryption0
        arguments:
          kmsProvider: local
          opts:
            # "key_material" repeated only 7 times (key material length == 84).
            keyMaterial: { $binary: { base64: a2V5X21hdGVyaWFsa2V5X21hdGVyaWFsa2V5X21hdGVyaWFsa2V5X21hdGVyaWFsa2V5X21hdGVyaWFsa2V5X21hdGVyaWFsa2V5X21hdGVyaWFs, subType: "00" } }
        expectError:
          isClientError: true
