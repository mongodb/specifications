{
  "collection_name": "test",
  "database_name": "change-stream-tests",
  "collection2_name": "test2",
  "database2_name": "change-stream-tests-2",
  "tests": [
    {
      "description": "change stream resumes after a network error",
      "minServerVersion": "4.2",
      "failPoint": {
        "configureFailPoint": "failCommand",
        "mode": {
          "times": 1
        },
        "data": {
          "failCommands": [
            "getMore"
          ],
          "closeConnection": true
        }
      },
      "target": "collection",
      "topology": [
        "replicaset",
        "sharded"
      ],
      "changeStreamPipeline": [],
      "changeStreamOptions": {},
      "operations": [
        {
          "database": "change-stream-tests",
          "collection": "test",
          "name": "insertOne",
          "arguments": {
            "document": {
              "x": 1
            }
          }
        }
      ],
      "expectations": [
        {
          "command_started_event": {
            "command": {
              "aggregate": "test",
              "cursor": {},
              "pipeline": [
                {
                  "$changeStream": {}
                }
              ]
            },
            "command_name": "aggregate",
            "database_name": "change-stream-tests"
          }
        },
        {
          "command_started_event": {
            "command": {
              "getMore": "42",
              "collection": "test"
            },
            "command_name": "getMore",
            "database_name": "change-stream-tests"
          }
        },
        {
          "command_started_event": {
            "command": {
              "aggregate": "test",
              "cursor": {},
              "pipeline": [
                {
                  "$changeStream": {}
                }
              ]
            }
          }
        }
      ],
      "result": {
        "success": [
          {
            "_id": "42",
            "documentKey": "42",
            "operationType": "insert",
            "ns": {
              "db": "change-stream-tests",
              "coll": "test"
            },
            "fullDocument": {
              "x": {
                "$numberInt": "1"
              }
            }
          }
        ]
      }
    },
    {
      "description": "change stream resumes after HostUnreachable",
      "minServerVersion": "4.2",
      "failPoint": {
        "configureFailPoint": "failCommand",
        "mode": {
          "times": 1
        },
        "data": {
          "failCommands": [
            "getMore"
          ],
          "errorCode": 6,
          "closeConnection": false
        }
      },
      "target": "collection",
      "topology": [
        "replicaset",
        "sharded"
      ],
      "changeStreamPipeline": [],
      "changeStreamOptions": {},
      "operations": [
        {
          "database": "change-stream-tests",
          "collection": "test",
          "name": "insertOne",
          "arguments": {
            "document": {
              "x": 1
            }
          }
        }
      ],
      "expectations": [
        {
          "command_started_event": {
            "command": {
              "aggregate": "test",
              "cursor": {},
              "pipeline": [
                {
                  "$changeStream": {}
                }
              ]
            },
            "command_name": "aggregate",
            "database_name": "change-stream-tests"
          }
        },
        {
          "command_started_event": {
            "command": {
              "getMore": "42",
              "collection": "test"
            },
            "command_name": "getMore",
            "database_name": "change-stream-tests"
          }
        },
        {
          "command_started_event": {
            "command": {
              "aggregate": "test",
              "cursor": {},
              "pipeline": [
                {
                  "$changeStream": {}
                }
              ]
            }
          }
        }
      ],
      "result": {
        "success": [
          {
            "_id": "42",
            "documentKey": "42",
            "operationType": "insert",
            "ns": {
              "db": "change-stream-tests",
              "coll": "test"
            },
            "fullDocument": {
              "x": {
                "$numberInt": "1"
              }
            }
          }
        ]
      }
    }
  ]
}
