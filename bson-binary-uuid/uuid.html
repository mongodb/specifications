<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>UUID - MongoDB Driver Specifications</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../driver-mantras.html">Mantras</a></li><li class="chapter-item expanded affix "><a href="../wireversion-featurelist/wireversion-featurelist.html">Wire Version Feature List</a></li><li class="chapter-item expanded affix "><li class="part-title">Specifications</li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.</strong> Serialization</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../BSON.html"><strong aria-hidden="true">1.1.</strong> BSON</a></li><li class="chapter-item expanded "><a href="../bson-objectid/objectid.html"><strong aria-hidden="true">1.2.</strong> ObjectId</a></li><li class="chapter-item expanded "><a href="../bson-decimal128/decimal128.html"><strong aria-hidden="true">1.3.</strong> Decimal128</a></li><li class="chapter-item expanded "><a href="../bson-binary-uuid/uuid.html" class="active"><strong aria-hidden="true">1.4.</strong> UUID</a></li><li class="chapter-item expanded "><a href="../dbref/dbref.html"><strong aria-hidden="true">1.5.</strong> DBRef</a></li><li class="chapter-item expanded "><a href="../extended-json/extended-json.html"><strong aria-hidden="true">1.6.</strong> Extended JSON</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Communication</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../message/OP_MSG.html"><strong aria-hidden="true">2.1.</strong> OP_MSG</a></li><li class="chapter-item expanded "><a href="../run-command/run-command.html"><strong aria-hidden="true">2.2.</strong> Command Execution</a></li><li class="chapter-item expanded "><a href="../connection-string/connection-string-spec.html"><strong aria-hidden="true">2.3.</strong> Connection String</a></li><li class="chapter-item expanded "><a href="../uri-options/uri-options.html"><strong aria-hidden="true">2.4.</strong> URI Options</a></li><li class="chapter-item expanded "><a href="../ocsp-support/ocsp-support.html"><strong aria-hidden="true">2.5.</strong> OCSP</a></li><li class="chapter-item expanded "><a href="../mongodb-handshake/handshake.html"><strong aria-hidden="true">2.6.</strong> Initial Handshake</a></li><li class="chapter-item expanded "><a href="../compression/OP_COMPRESSED.html"><strong aria-hidden="true">2.7.</strong> Wire Compression</a></li><li class="chapter-item expanded "><a href="../socks5-support/socks5.html"><strong aria-hidden="true">2.8.</strong> SOCKS5</a></li><li class="chapter-item expanded "><a href="../initial-dns-seedlist-discovery/initial-dns-seedlist-discovery.html"><strong aria-hidden="true">2.9.</strong> Initial DNS Seedlist Discovery</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Connectivity</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../server-discovery-and-monitoring/server-discovery-and-monitoring.html"><strong aria-hidden="true">3.1.</strong> Server Discovery and Monitoring</a></li><li class="chapter-item expanded "><a href="../connection-monitoring-and-pooling/connection-monitoring-and-pooling.html"><strong aria-hidden="true">3.2.</strong> Connection Monitoring and Pooling</a></li><li class="chapter-item expanded "><a href="../load-balancers/load-balancers.html"><strong aria-hidden="true">3.3.</strong> Load Balancer Support</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Availability</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../server-discovery-and-monitoring/server-monitoring.html"><strong aria-hidden="true">4.1.</strong> Server Monitoring</a></li><li class="chapter-item expanded "><a href="../polling-srv-records-for-mongos-discovery/polling-srv-records-for-mongos-discovery.html"><strong aria-hidden="true">4.2.</strong> SRV Polling for mongos Discovery</a></li><li class="chapter-item expanded "><a href="../server-selection/server-selection.html"><strong aria-hidden="true">4.3.</strong> Server Selection</a></li><li class="chapter-item expanded "><a href="../max-staleness/max-staleness.html"><strong aria-hidden="true">4.4.</strong> Max Staleness</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Resilience</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.</strong> Retryability</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../retryable-reads/retryable-reads.html"><strong aria-hidden="true">5.1.1.</strong> Reads</a></li><li class="chapter-item expanded "><a href="../retryable-writes/retryable-writes.html"><strong aria-hidden="true">5.1.2.</strong> Writes</a></li></ol></li><li class="chapter-item expanded "><a href="../client-side-operations-timeout/client-side-operations-timeout.html"><strong aria-hidden="true">5.2.</strong> CSOT</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.3.</strong> Consistency</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../sessions/driver-sessions.html"><strong aria-hidden="true">5.3.1.</strong> Sessions</a></li><li class="chapter-item expanded "><a href="../causal-consistency/causal-consistency.html"><strong aria-hidden="true">5.3.2.</strong> Causal Consistency</a></li><li class="chapter-item expanded "><a href="../sessions/snapshot-sessions.html"><strong aria-hidden="true">5.3.3.</strong> Snapshot Reads</a></li><li class="chapter-item expanded "><a href="../transactions/transactions.html"><strong aria-hidden="true">5.3.4.</strong> Transactions</a></li><li class="chapter-item expanded "><a href="../transactions-convenient-api/transactions-convenient-api.html"><strong aria-hidden="true">5.3.5.</strong> Convenient Transactions API</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Programmability</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Resource Management</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../enumerate-databases/enumerate-databases.html"><strong aria-hidden="true">6.1.1.</strong> Databases</a></li><li class="chapter-item expanded "><a href="../enumerate-collections/enumerate-collections.html"><strong aria-hidden="true">6.1.2.</strong> Collections</a></li><li class="chapter-item expanded "><a href="../index-management/index-management.html"><strong aria-hidden="true">6.1.3.</strong> Indexes</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Data Management</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../crud/crud.html"><strong aria-hidden="true">6.2.1.</strong> CRUD</a></li><li class="chapter-item expanded "><a href="../collation/collation.html"><strong aria-hidden="true">6.2.2.</strong> Collation</a></li><li class="chapter-item expanded "><a href="../server_write_commands/server_write_commands.html"><strong aria-hidden="true">6.2.3.</strong> Write Commands</a></li><li class="chapter-item expanded "><a href="../driver-bulk-update.html"><strong aria-hidden="true">6.2.4.</strong> Bulk API</a></li><li class="chapter-item expanded "><a href="../crud/bulk-write.html"><strong aria-hidden="true">6.2.5.</strong> Bulk Write</a></li><li class="chapter-item expanded "><a href="../read-write-concern/read-write-concern.html"><strong aria-hidden="true">6.2.6.</strong> R/W Concern</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.3.</strong> Cursors</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../change-streams/change-streams.html"><strong aria-hidden="true">6.3.1.</strong> Change Streams</a></li><li class="chapter-item expanded "><a href="../find_getmore_killcursors_commands/find_getmore_killcursors_commands.html"><strong aria-hidden="true">6.3.2.</strong> find/getMore/killCursors</a></li></ol></li><li class="chapter-item expanded "><a href="../gridfs/gridfs-spec.html"><strong aria-hidden="true">6.4.</strong> GridFS</a></li><li class="chapter-item expanded "><a href="../versioned-api/versioned-api.html"><strong aria-hidden="true">6.5.</strong> Stable API</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.6.</strong> Security</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../client-side-encryption/client-side-encryption.html"><strong aria-hidden="true">6.6.1.</strong> Client Side Encryption</a></li><li class="chapter-item expanded "><a href="../bson-binary-encrypted/binary-encrypted.html"><strong aria-hidden="true">6.6.2.</strong> BSON Binary Subtype 6</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Observability</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../command-logging-and-monitoring/command-logging-and-monitoring.html"><strong aria-hidden="true">7.1.</strong> Command Logging and Monitoring</a></li><li class="chapter-item expanded "><a href="../server-discovery-and-monitoring/server-discovery-and-monitoring-logging-and-monitoring.html"><strong aria-hidden="true">7.2.</strong> SDAM Logging and Monitoring</a></li><li class="chapter-item expanded "><a href="../logging/logging.html"><strong aria-hidden="true">7.3.</strong> Standardized Logging</a></li><li class="chapter-item expanded "><a href="../connection-monitoring-and-pooling/connection-monitoring-and-pooling.html"><strong aria-hidden="true">7.4.</strong> Connection Pool Logging</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Testability</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../unified-test-format/unified-test-format.html"><strong aria-hidden="true">8.1.</strong> Unified Test Format</a></li><li class="chapter-item expanded "><a href="../atlas-data-lake-testing/tests/index.html"><strong aria-hidden="true">8.2.</strong> Atlas Data Federation Testing</a></li><li class="chapter-item expanded "><a href="../benchmarking/benchmarking.html"><strong aria-hidden="true">8.3.</strong> Performance Benchmarking</a></li><li class="chapter-item expanded "><a href="../bson-corpus/bson-corpus.html"><strong aria-hidden="true">8.4.</strong> BSON Corpus</a></li><li class="chapter-item expanded "><a href="../connections-survive-step-down/tests/index.html"><strong aria-hidden="true">8.5.</strong> Replication Event Resilience</a></li><li class="chapter-item expanded "><a href="../faas-automated-testing/faas-automated-testing.html"><strong aria-hidden="true">8.6.</strong> FAAS Automated Testing</a></li><li class="chapter-item expanded "><a href="../serverless-testing/index.html"><strong aria-hidden="true">8.7.</strong> Atlas Serverless Testing</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MongoDB Driver Specifications</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="bson-binary-uuid"><a class="header" href="#bson-binary-uuid">BSON Binary UUID</a></h1>
<ul>
<li>Status: Accepted</li>
<li>Minimum Server Version: N/A</li>
</ul>
<hr />
<h2 id="abstract"><a class="header" href="#abstract">Abstract</a></h2>
<p>The Java, C#, and Python drivers natively support platform types for UUID, all of which by default encode them to and
decode them from BSON binary subtype 3. However, each encode the bytes in a different order from the others. To improve
interoperability, BSON binary subtype 4 was introduced and defined the byte order according to
<a href="https://tools.ietf.org/html/rfc4122#section-4.1.2">RFC 4122</a>, and a mechanism to configure each driver to encode UUIDs
this way was added to each driver. The legacy representation remained as the default for each driver.</p>
<p>This specification moves MongoDB drivers further towards the standard UUID representation by requiring an application
relying on native UUID support to explicitly specify the representation it requires.</p>
<p>Drivers that support native UUID types will additionally create helpers on their BsonBinary class that will aid in
conversion to and from the platform native UUID type.</p>
<h2 id="meta"><a class="header" href="#meta">META</a></h2>
<p>The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in <a href="https://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>.</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<h3 id="terms"><a class="header" href="#terms">Terms</a></h3>
<p><strong>UUID</strong></p>
<p>A Universally Unique IDentifier</p>
<p><strong>BsonBinary</strong></p>
<p>An object that wraps an instance of a BSON binary value</p>
<h3 id="naming-deviations"><a class="header" href="#naming-deviations">Naming Deviations</a></h3>
<p>All drivers MUST name operations, objects, and parameters as defined in the following sections.</p>
<p>The following deviations are permitted:</p>
<ul>
<li>Drivers can use the platform's name for a UUID. For instance, in C# the platform class is Guid, whereas in Java it is
UUID.</li>
<li>Drivers can use a "to" prefix instead of an "as" prefix for the BsonBinary method names.</li>
</ul>
<h3 id="explicit-encoding-and-decoding"><a class="header" href="#explicit-encoding-and-decoding">Explicit encoding and decoding</a></h3>
<p>Any driver with a native UUID type MUST add the following UuidRepresentation enumeration, and associated methods to its
BsonBinary (or equivalent) class:</p>
<pre><code class="language-typescript">/**

enum UuidRepresentation {

   /**
    * An unspecified representation of UUID.  Essentially, this is the null 
    * representation value. This value is not required for languages that      
    * have better ways of indicating, or preventing use of, a null value.
    */
   UNSPECIFIED("unspecified"),

   /**
    * The canonical representation of UUID according to RFC 4122, 
    * section 4.1.2 
    * 
    * It encodes as BSON binary subtype 4
   */
   STANDARD("standard"),

   /**
    * The legacy representation of UUID used by the C# driver.
    *
    * In this representation the order of bytes 0-3 are reversed, the 
    * order of bytes 4-5 are reversed, and the order of bytes 6-7 are 
    * reversed.
    *
    * It encodes as BSON binary subtype 3
    */
   C_SHARP_LEGACY("csharpLegacy"),

   /**
    * The legacy representation of UUID used by the Java driver.
    *
    * In this representation the order of bytes 0-7 are reversed, and the 
    * order of bytes 8-15 are reversed.
    *
    * It encodes as BSON binary subtype 3
    */
   JAVA_LEGACY("javaLegacy"),

  /**
   * The legacy representation of UUID used by the Python driver.
   *
   * As with STANDARD, this representation conforms with RFC 4122, section
   * 4.1.2 
   *
   * It encodes as BSON binary subtype 3
   */
   PYTHON_LEGACY("pythonLegacy")
}

class BsonBinary {
   /* 
    * Construct from a UUID using the standard UUID representation
    * [Specification] This constructor SHOULD be included but MAY be 
    *                 omitted if it creates backwards compatibility issues
    */
   constructor(Uuid uuid) 

   /*
    * Construct from a UUID using the given UUID representation.
    *
    * The representation must not be equal to UNSPECIFIED
    */
   constructor(Uuid uuid, UuidRepresentation representation)

   /*
    * Decode a subtype 4 binary to a UUID, erroring when the subtype is not 4.
    */
   Uuid asUuid()  

   /*
    * Decode a subtype 3 or 4 to a UUID, according to the UUID    
    * representation, erroring when subtype does not match the
    * representation.
    */
   Uuid asUuid(UuidRepresentation representation)
}
</code></pre>
<h3 id="implicit-decoding-and-encoding"><a class="header" href="#implicit-decoding-and-encoding">Implicit decoding and encoding</a></h3>
<p>A new driver for a language with a native UUID type MUST NOT implicitly encode from or decode to the native UUID type.
Rather, explicit conversion MUST be used as described in the previous section.</p>
<p>Drivers that already do such implicit encoding and decoding SHOULD support a URI option, uuidRepresentation, which
controls the default behavior of the UUID codec. Alternatively, a driver MAY specify the UUID representation via global
state.</p>
<div class="table-wrapper"><table><thead><tr><th>Value</th><th>Default?</th><th>Encode to</th><th>Decode subtype 4 to</th><th>Decode subtype 3 to</th></tr></thead><tbody>
<tr><td>unspecified</td><td>yes</td><td>raise error</td><td>BsonBinary</td><td>BsonBinary</td></tr>
<tr><td>standard</td><td>no</td><td>BSON binary subtype 4</td><td>native UUID</td><td>BsonBinary</td></tr>
<tr><td>csharpLegacy</td><td>no</td><td>BSON binary subtype 3 with C# legacy byte order</td><td>BsonBinary</td><td>native UUID</td></tr>
<tr><td>javaLegacy</td><td>no</td><td>BSON binary subtype 3 with Java legacy byte order</td><td>BsonBinary</td><td>native UUID</td></tr>
<tr><td>pythonLegacy</td><td>no</td><td>BSON binary subtype 3 with standard byte order</td><td>BsonBinary</td><td>native UUID</td></tr>
</tbody></table>
</div>
<p>For scenarios where the application makes the choice (e.g. a POJO with a field of type UUID), or when serializers are
strongly typed and are constrained to always return values of a certain type, the driver will raise an exception in
cases where otherwise it would be required to decode to a different type (e.g. BsonBinary instead of UUID or vice
versa).</p>
<p>Note also that none of the above applies when decoding to strictly typed maps, e.g. a <code>Map&lt;String, BsonValue&gt;</code> like Java
or .NET's BsonDocument class. In those cases the driver is always decoding to BsonBinary, and applications would use the
asUuid methods to explicitly convert from BsonBinary to UUID.</p>
<h3 id="implementation-notes"><a class="header" href="#implementation-notes">Implementation Notes</a></h3>
<p>Since changing the default UUID representation can reasonably be considered a backwards-breaking change, drivers that
implement the full specification should stage implementation according to semantic versioning guidelines. Specifically,
support for this specification can be added to a minor release, but with several exceptions:</p>
<p>The default UUID representation should be left as is (e.g. JAVA_LEGACY for the Java driver) rather than be changed to
UNSPECIFIED. In a subsequent major release, the default UUID representation can be changed to UNSPECIFIED (along with
appropriate documentation indicating the backwards-breaking change). Drivers MUST document this in a prior minor
release.</p>
<h2 id="test-plan"><a class="header" href="#test-plan">Test Plan</a></h2>
<p>The test plan consists of a series of prose tests. They all operate on the same UUID, with the String representation of
"00112233-4455-6677-8899-aabbccddeeff".</p>
<h3 id="explicit-encoding"><a class="header" href="#explicit-encoding">Explicit encoding</a></h3>
<ol>
<li>Create a BsonBinary instance with the given UUID
<ul>
<li>Assert that the BsonBinary instance's subtype is equal to 4 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Create a BsonBinary instance with the given UUID and UuidRepresentation equal to STANDARD
<ul>
<li>Assert that the BsonBinary instance's subtype is equal to 4 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Create a BsonBinary instance with the given UUID and UuidRepresentation equal to JAVA_LEGACY
<ul>
<li>Assert that the BsonBinary instance's subtype is equal to 3 and data equal to the hex-encoded string
"7766554433221100FFEEDDCCBBAA9988"</li>
</ul>
</li>
<li>Create a BsonBinary instance with the given UUID and UuidRepresentation equal to CSHARP_LEGACY
<ul>
<li>Assert that the BsonBinary instance's subtype is equal to 3 and data equal to the hex-encoded string
"33221100554477668899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Create a BsonBinary instance with the given UUID and UuidRepresentation equal to PYTHON_LEGACY
<ul>
<li>Assert that the BsonBinary instance's subtype is equal to 3 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Create a BsonBinary instance with the given UUID and UuidRepresentation equal to UNSPECIFIED
<ul>
<li>Assert that an error is raised</li>
</ul>
</li>
</ol>
<h3 id="explicit-decoding"><a class="header" href="#explicit-decoding">Explicit Decoding</a></h3>
<ol>
<li>Create a BsonBinary instance with subtype equal to 4 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"
<ol>
<li>Assert that a call to BsonBinary.asUuid() returns the given UUID</li>
<li>Assert that a call to BsonBinary.asUuid(STANDARD) returns the given UUID</li>
<li>Assert that a call to BsonBinary.asUuid(UNSPECIFIED) raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(JAVA_LEGACY) raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(CSHARP_LEGACY) raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(PYTHON_LEGACY) raises an error</li>
</ol>
</li>
<li>Create a BsonBinary instance with subtype equal to 3 and data equal to the hex-encoded string
"7766554433221100FFEEDDCCBBAA9988"
<ol>
<li>Assert that a call to BsonBinary.asUuid() raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(STANDARD) raised an error</li>
<li>Assert that a call to BsonBinary.asUuid(UNSPECIFIED) raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(JAVA_LEGACY) returns the given UUID</li>
</ol>
</li>
<li>Create a BsonBinary instance with subtype equal to 3 and data equal to the hex-encoded string
"33221100554477668899AABBCCDDEEFF"
<ol>
<li>Assert that a call to BsonBinary.asUuid() raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(STANDARD) raised an error</li>
<li>Assert that a call to BsonBinary.asUuid(UNSPECIFIED) raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(CSHARP_LEGACY) returns the given UUID</li>
</ol>
</li>
<li>Create a BsonBinary instance with subtype equal to 3 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"
<ol>
<li>Assert that a call to BsonBinary.asUuid() raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(STANDARD) raised an error</li>
<li>Assert that a call to BsonBinary.asUuid(UNSPECIFIED) raises an error</li>
<li>Assert that a call to BsonBinary.asUuid(PYTHON_LEGACY) returns the given UUID</li>
</ol>
</li>
</ol>
<h3 id="implicit-encoding"><a class="header" href="#implicit-encoding">Implicit encoding</a></h3>
<ol>
<li>Set the uuidRepresentation of the client to "javaLegacy". Insert a document with an "_id" key set to the given
native UUID value.
<ul>
<li>Assert that the actual value inserted is a BSON binary with subtype 3 and data equal to the hex-encoded string
"7766554433221100FFEEDDCCBBAA9988"</li>
</ul>
</li>
<li>Set the uuidRepresentation of the client to "charpLegacy". Insert a document with an "_id" key set to the given
native UUID value.
<ul>
<li>Assert that the actual value inserted is a BSON binary with subtype 3 and data equal to the hex-encoded string
"33221100554477668899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Set the uuidRepresentation of the client to "pythonLegacy". Insert a document with an "_id" key set to the given
native UUID value.
<ul>
<li>Assert that the actual value inserted is a BSON binary with subtype 3 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Set the uuidRepresentation of the client to "standard". Insert a document with an "_id" key set to the given native
UUID value.
<ul>
<li>Assert that the actual value inserted is a BSON binary with subtype 4 and data equal to the hex-encoded string
"00112233445566778899AABBCCDDEEFF"</li>
</ul>
</li>
<li>Set the uuidRepresentation of the client to "unspecified". Insert a document with an "_id" key set to the given
native UUID value.
<ul>
<li>Assert that a BSON serialization exception is thrown</li>
</ul>
</li>
</ol>
<h3 id="implicit-decoding"><a class="header" href="#implicit-decoding">Implicit Decoding</a></h3>
<ol>
<li>
<p>Set the uuidRepresentation of the client to "javaLegacy". Insert a document containing two fields. The "standard"
field should contain a BSON Binary created by creating a BsonBinary instance with the given UUID and the STANDARD
UuidRepresentation. The "legacy" field should contain a BSON Binary created by creating a BsonBinary instance with
the given UUID and the JAVA_LEGACY UuidRepresentation. Find the document.</p>
<ol>
<li>Assert that the value of the "standard" field is of type BsonBinary and is equal to the inserted value.</li>
<li>Assert that the value of the "legacy" field is of the native UUID type and is equal to the given UUID</li>
</ol>
<p>Repeat this test with the uuidRepresentation of the client set to "csharpLegacy" and "pythonLegacy".</p>
</li>
<li>
<p>Set the uuidRepresentation of the client to "standard". Insert a document containing two fields. The "standard" field
should contain a BSON Binary created by creating a BsonBinary instance with the given UUID and the STANDARD
UuidRepresentation. The "legacy" field should contain a BSON Binary created by creating a BsonBinary instance with
the given UUID and the PYTHON_LEGACY UuidRepresentation. Find the document.</p>
<ol>
<li>Assert that the value of the "standard" field is of the native UUID type and is equal to the given UUID</li>
<li>Assert that the value of the "legacy" field is of type BsonBinary and is equal to the inserted value.</li>
</ol>
</li>
<li>
<p>Set the uuidRepresentation of the client to "unspecified". Insert a document containing two fields. The "standard"
field should contain a BSON Binary created by creating a BsonBinary instance with the given UUID and the STANDARD
UuidRepresentation. The "legacy" field should contain a BSON Binary created by creating a BsonBinary instance with
the given UUID and the PYTHON_LEGACY UuidRepresentation. Find the document.</p>
<ol>
<li>Assert that the value of the "standard" field is of type BsonBinary and is equal to the inserted value</li>
<li>Assert that the value of the "legacy" field is of type BsonBinary and is equal to the inserted value.</li>
</ol>
<p>Repeat this test with the uuidRepresentation of the client set to "csharpLegacy" and "pythonLegacy".</p>
</li>
</ol>
<p>Note: the assertions will be different in the release prior to the major release, to avoid breaking changes. Adjust
accordingly!</p>
<h2 id="q--a"><a class="header" href="#q--a">Q &amp; A</a></h2>
<h3 id="whats-the-rationale-for-the-deviations-allowed-by-the-specification"><a class="header" href="#whats-the-rationale-for-the-deviations-allowed-by-the-specification">What's the rationale for the deviations allowed by the specification?</a></h3>
<p>In short, the C# driver has existing behavior that make it infeasible to work the same as other drivers.</p>
<p>The C# driver has a global serialization registry. Since it's global and not per-MongoClient, it's not feasible to
override the UUID representation on a per-MongoClient basis, since doing so would require a per-MongoClient registry.
Instead, the specification allows for a global override so that the C# driver can implement the specification.</p>
<p>Additionally, the C# driver has an existing configuration parameter that controls the behavior of BSON readers and
writers at a level below the serializers. This configuration affects the semantics of the existing BsonBinary class in a
way that doesn't allow for the constructor(UUID) mentioned in the specification. For this reason, that constructor is
specified as optional.</p>
<h2 id="changelog"><a class="header" href="#changelog">Changelog</a></h2>
<ul>
<li>2024-08-01: Migrated from reStructuredText to Markdown.</li>
<li>2022-10-05: Remove spec front matter.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../bson-decimal128/decimal128.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../dbref/dbref.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../bson-decimal128/decimal128.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../dbref/dbref.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
